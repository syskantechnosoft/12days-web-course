<%- include('partials/header', { title: title }) %>

<h1><%= title %></h1>

<% if (typeof searchQuery !== 'undefined' && searchQuery) { %>
  <p class="search-info">
    Showing results for "<strong><%= searchQuery %></strong>"
    (<%= posts.length %> <%= posts.length === 1 ? 'result' : 'results' %>)
  </p>
<% } %>

<div class="posts-grid">
  <% if (posts.length === 0) { %>
    <div class="no-posts">
      <h2>No posts found</h2>
      <p>Be the first to create a post!</p>
      <a href="/create" class="btn btn-primary">Create Post</a>
    </div>
  <% } else { %>
    <% posts.forEach(post => { %>
      <article class="post-card">
        <h2 class="post-title">
          <a href="/posts/<%= post.id %>"><%= post.title %></a>
        </h2>
        
        <div class="post-meta">
          <span class="author">By <%= post.author %></span>
          <span class="date"><%= post.createdAt.toLocaleDateString() %></span>
          <span class="likes">❤️ <%= post.likes %></span>
        </div>
        
        <p class="post-excerpt">
          <%= post.content.substring(0, 150) %>...
        </p>
        
        <div class="post-actions">
          <a href="/posts/<%= post.id %>" class="btn btn-secondary">Read More</a>
          <button class="btn btn-like" onclick="likePost(<%= post.id %>)">
            Like (❤️ <%= post.likes %>)
          </button>
        </div>
      </article>
    <% }); %>
  <% } %>
</div>

<script>
  async function likePost(postId) {
    try {
      const response = await fetch(`/api/posts/${postId}/like`, {
        method: 'PATCH'
      });
      
      const data = await response.json();
      
      if (response.ok) {
        alert(`Post liked! Total likes: ${data.likes}`);
        location.reload();
      } else {
        alert('Error liking post');
      }
    } catch (error) {
      console.error('Error:', error);
      alert('Error liking post');
    }
  }
</script>

<%- include('partials/footer') %>
